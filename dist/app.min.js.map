{"version":3,"sources":["app.min.js"],"names":["NoahsApp","angular","module","config","$stateProvider","$urlRouterProvider","otherwise","state","url","templateUrl","controller","controllerAs","service","$http","this","requestTifs","apikey","query","method","data","then","result","console","log","fakePumps","id","name","latitude","longitude","createPumpMarkers","pumpdata","pumps","i","length","pump","newPump","L","marker","bindPopup","openPopup","push","fetchPumpData","err","message","$scope","FmiAPIService","apierror","api_field","query_field","fmilink","tiflinks","sendRequest","generateMap","index","checkIfErrorUndefined","PumpService","conversion","a","b","firstProjection","secondProjection","coordinates","proj4","crs","Proj","CRS","TMS","resolutions","mymap","Map","continuousWorld","worldCopyJump","zoomControl","layers","tileUrl","attrib","tilelayer","TileLayer","maxZoom","minZoom","tileSize","tms","attribution","subdomains","tutkakuvaUrl","tutkakuvaBounds","imageOverlay","addTo","addLayer","setView","oikeaTuppi","vasenYla","oikeaAla","vasenAla","ikaalinen","vimpeli","utajarvi","petajavesi","kuopio","kesalahti","joku2","joku","jokuryhma","layerGroup","circle","color","fillColor","fillOpacity","directive","$stateParams"],"mappings":"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","file":"app.min.js","sourcesContent":["var NoahsApp = angular.module(\"NoahsApp\", [\"ui.router\"]);\n\nNoahsApp.config([\"$stateProvider\", \"$urlRouterProvider\", function($stateProvider, $urlRouterProvider) {\r\n  $urlRouterProvider.otherwise(\"/\");\r\n\r\n  $stateProvider\r\n    .state(\"main\", {\r\n      url: \"/\",\r\n      templateUrl: \"app/components/main/main.html\",\r\n      controller: \"MainController\",\r\n      controllerAs: \"main\"\r\n    })\r\n    .state(\"map\", {\r\n      url: \"/map\",\r\n      templateUrl: \"app/components/map/map.html\",\r\n      controller: \"MapController\",\r\n      controllerAs: \"map\"\r\n    })\r\n    .state(\"pump\", {\r\n      url: \"/pump/:id\",\r\n      templateUrl: \"app/components/pump/pump.html\",\r\n      controller: \"PumpController\",\r\n      controllerAs: \"pump\"\r\n    })\r\n}])\r\n\nNoahsApp.service(\"FmiAPIService\", [\"$http\", function($http) {\r\n  this.requestTifs = function(apikey, query) {\r\n    var config = {\r\n      method: \"POST\",\r\n      url: \"https://noahs-app-backend.herokuapp.com/radar\",\r\n      data: {\r\n        apikey: apikey,\r\n        query: query,\r\n      }\r\n    }\r\n    return $http(config)\r\n      .then(function(result) {\r\n        console.log(result);\r\n        return result.data;\r\n      })\r\n  }\r\n}]);\r\n\nNoahsApp.service(\"PumpService\", [\"$http\", function($http) {\r\n  this.fakePumps = [\r\n    {\r\n      id: 1,\r\n      name: \"pumppu lol\",\r\n      latitude: 59,\r\n      longitude: 25,\r\n    },\r\n    {\r\n      id: 2,\r\n      name: \"toka pumppu\",\r\n      latitude: 59.5,\r\n      longitude: 25,\r\n    },\r\n    {\r\n      id: 3,\r\n      name: \"kolmas pumppu\",\r\n      latitude: 60,\r\n      longitude: 25,\r\n    }\r\n  ]\r\n  this.createPumpMarkers = function(pumpdata) {\r\n    var pumps = [];\r\n    for(var i = 0; i < pumpdata.length; i++) {\r\n      var pump = pumpdata[i];\r\n      var newPump = L.marker([pump.latitude, pump.longitude])\r\n        .bindPopup(\"Pumppu \" + pump.id).openPopup();\r\n      pumps.push(newPump);\r\n    }\r\n    return pumps;\r\n  }\r\n  this.fetchPumpData = function() {\r\n    var config = {\r\n      method: \"POST\",\r\n      url: \"http://10.144.72.11\",\r\n      data: {\r\n        apikey: apikey,\r\n        query: query,\r\n      }\r\n    }\r\n    return $http(config)\r\n      .then(function(result) {\r\n        console.log(result);\r\n        return result.data;\r\n      })\r\n      .catch(function(err) {\r\n        console.log(\"Calling API produced an error:\");\r\n        console.log(err.data.message);\r\n        return [];\r\n      })\r\n  }\r\n}])\r\n\nNoahsApp.controller(\"MainController\", [\"$scope\", \"FmiAPIService\", function($scope, FmiAPIService) {\r\n  $scope.apierror = {};\r\n  $scope.api_field = \"5c2fc68e-d165-45f5-af8f-ce9fc0b36e68\";\r\n  $scope.query_field = \"/wfs?request=GetFeature&storedquery_id=fmi::radar::composite::rr\";\r\n  $scope.fmilink = \"\";\r\n  $scope.tiflinks = [];\r\n\r\n  $scope.sendRequest = function() {\r\n    FmiAPIService\r\n      .requestTifs($scope.api_field, $scope.query_field)\r\n      .then(function(result) {\r\n        console.log(\"Got result\");\r\n        console.log(result);\r\n        $scope.fmilink = result.fmilink;\r\n        $scope.tiflinks = result.tiflinks;\r\n        $scope.apierror = {};\r\n      })\r\n      .catch(function(err) {\r\n        console.log(err.data.message);\r\n        $scope.apierror = err.data;\r\n        console.log($scope.apierror);\r\n      })\r\n  }\r\n\r\n  $scope.generateMap = function(index) {\r\n    // var picture = $scope.tiflinks[index];\r\n    // PictureService\r\n    //   .requestRadarPicture(picture)\r\n    //   .then(function(result) {\r\n    //\r\n    //   })\r\n  }\r\n\r\n  $scope.checkIfErrorUndefined = function() {\r\n    return typeof $scope.apierror.message === \"undefined\";\r\n  }\r\n}])\r\n\nNoahsApp.controller(\"MapController\", [\"$scope\", \"PumpService\", function($scope, PumpService) {\r\n  function conversion(a, b) {\r\n    var firstProjection = \"+proj=utm +zone=35 +ellps=GRS80 +units=m +no_defs +towgs84=0,0,0,-0,-0,-0,0\";\r\n    var secondProjection = \"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs\";\r\n    var coordinates = proj4(firstProjection, secondProjection, [a, b]);\r\n    return coordinates;\r\n  }\r\n\r\n  var crs = new L.Proj.CRS.TMS('EPSG:3067',\r\n    '+proj=utm +zone=35 +ellps=GRS80 +units=m +towgs84=0,0,0,-0,-0,-0,0 +no_defs', [-548576.0, 6291456.0, 1548576.0, 8388608], {\r\n      resolutions: [\r\n        8192,\r\n        4096,\r\n        2048,\r\n        1024,\r\n        512,\r\n        256,\r\n        128,\r\n        64,\r\n        32,\r\n        16,\r\n        8,\r\n        4,\r\n        2,\r\n        1,\r\n        0.5,\r\n        0.25\r\n      ]\r\n    });\r\n\r\n  var mymap = new L.Map('map', {\r\n    crs: crs,\r\n    continuousWorld: true,\r\n    worldCopyJump: false,\r\n    zoomControl: true,\r\n    layers: []\r\n  });\r\n\r\n  var tileUrl = 'https://{s}.kapsi.fi/mapcache/peruskartta_3067/{z}/{x}/{y}.png';\r\n  var attrib = '&copy; Karttamateriaali <a href=\"http://www.maanmittauslaitos.fi/avoindata\">Maanmittauslaitos</a>';\r\n  var tilelayer = new L.Proj.TileLayer.TMS(tileUrl, crs, {\r\n      maxZoom: 14,\r\n      minZoom: 0,\r\n      tileSize: 256,\r\n      tms: false,\r\n      continuousWorld: true,\r\n      attribution: attrib,\r\n      subdomains: ['tile1', 'tile2']\r\n    });\r\n\r\n  // var tutkalayer = new L.tileLayer(\"/img/sade-tutka.png\", {\r\n  //   attribution: \"tutka kartta\"\r\n  // }).addTo(mymap);\r\n\r\n  // tutkan koordinatit parsittu fmi-xml:stä gml-coordinates nimellä\r\n  // -118331.366 7907751.537 875567.732 7907751.537 875567.732 6335621.167 -118331.366 6335621.167 -118331.366 7907751.537\r\n  console.log(conversion(7907751.537, -118331.366));\r\n  console.log(conversion(-118331.366, 7907751.537));\r\n  console.log(conversion(875567.732, 7907751.537));\r\n  console.log(conversion(875567.732, 6335621.167));\r\n  console.log(conversion(-118331.366, 6335621.167));\r\n  console.log(conversion(-118331.366, 7907751.537));\r\n  // var tutkakuvaBounds = [\r\n    // [33.18909488231688, 57.01073316247846],  // oikea yläkulma\r\n    // [10.2139235307523, 70.49988067141419], // vasen yläkulma\r\n    // [37.37170826858529, 70.9830591433417], // vasen\r\n    // [16.86739870411734, 56.75131897332151],\r\n    // [10.2139235307523, 70.49988067141419]\r\n  // ];\r\n\r\n  var tutkakuvaUrl = '/img/sade-tutka.png';\r\n  // var tutkakuvaBounds = [\r\n  //   [70.49988067141419, 10.2139235307523],\r\n  //   [57.01073316247846, 33.18909488231688]\r\n  // ];\r\n\r\n  var tutkakuvaBounds = [\r\n    // [7907751.537, -118331.366],\r\n    // [875567.732, 6335621.167]\r\n    [57.01073316247846, 35.67170826858529],\r\n    [70.49988067141419, 8.5139235307523],\r\n  ];\r\n\r\n  L.imageOverlay(tutkakuvaUrl, tutkakuvaBounds).addTo(mymap);\r\n\r\n  mymap.addLayer(tilelayer);\r\n  mymap.setView([65.01275, 25.46815], 2);\r\n\r\n  function addMarker(a, b) {\r\n    var coord = conversion(a, b);\r\n    var markern = L.marker([coord[1], coord[0]]).addTo(mymap);\r\n  }\r\n\r\n  var oikeaTuppi = L.marker([10.2139235307523, 70.49988067141419]).bindPopup(\"Oikea tuppi\").openPopup();\r\n  // var oikeaYla = L.marker([70.49988067141419, 10.2139235307523]).bindPopup(\"Oikea yläkulma\").openPopup();\r\n  var vasenYla = L.marker([70.49988067141419, 37.37170826858529]).bindPopup(\"Vasen yläkulma\").openPopup();\r\n  var oikeaAla = L.marker([57.01073316247846, 10.2139235307523]).bindPopup(\"Oikea alakulma\").openPopup();\r\n  var vasenAla = L.marker([57.01073316247846, 37.37170826858529]).bindPopup(\"Vasen alakulma\").openPopup();\r\n\r\n  // radars from http://ilmatieteenlaitos.fi/suomen-tutkaverkko\r\n  var ikaalinen = L.marker([61.7673, 23.0764]).bindPopup(\"Ikaalisen tutka-asema\").openPopup();\r\n  var vimpeli = L.marker([63.1048, 23.8209]).bindPopup(\"Vimpelin tutka-asema\").openPopup();\r\n  var utajarvi = L.marker([64.7749, 26.3189]).bindPopup(\"Utajärven tutka-asema\").openPopup();\r\n  var petajavesi = L.marker([62.3045, 25.4401]).bindPopup(\"Petäjäveden tutka-asema\").openPopup();\r\n  var kuopio = L.marker([62.8626, 27.3815]).bindPopup(\"Kuopion tutka-asema\").openPopup();\r\n  var kesalahti = L.marker([61.9070, 29.7977]).bindPopup(\"Kiteen tutka-asema\").openPopup();\r\n\r\n  var joku2 = L.marker([65.01275, 25.56815]).bindPopup(\"<a target='_blank' href='https://google.com'>I am a popup.</a>\").openPopup();\r\n  var joku = L.marker([65.01275, 25.46815]).bindPopup(\"<a target='_blank' href='https://google.com'>I am a popup.</a>\").openPopup();\r\n\r\n  var jokuryhma = L.layerGroup([oikeaTuppi, vasenYla, oikeaAla, vasenAla, ikaalinen, vimpeli, utajarvi, petajavesi, kuopio, kesalahti, joku2, joku]);\r\n\r\n  // var myMap = L.map('map', options);\r\n  // var measureControl = new L.Control.Measure(options);\r\n  // measureControl.addTo(myMap);\r\n\r\n  var circle = L.circle([65.01275, 25.46815], 500, {\r\n    color: 'red',\r\n    fillColor: '#f03',\r\n    fillOpacity: 0.5\r\n  }).addTo(mymap);\r\n\r\n  var pumps = L.layerGroup(PumpService.createPumpMarkers(PumpService.fakePumps));\r\n\r\n  jokuryhma.addTo(mymap);\r\n  pumps.addTo(mymap);\r\n}])\r\n\nNoahsApp.directive(\"navDirective\", function() {\r\n  return {\r\n    templateUrl: \"app/components/nav/nav.html\",    \r\n  }\r\n})\r\n\nNoahsApp.controller(\"PumpController\", [\"$scope\", \"$stateParams\", \"PumpService\", function($scope, $stateParams, PumpService) {\r\n  $scope.id = $stateParams.id;\r\n}])\r\n"]}