var NoahsApp=angular.module("NoahsApp",["ui.router"]);NoahsApp.config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("main",{url:"/",templateUrl:"app/components/main/main.html",controller:"MainController"}).state("map",{url:"/map",templateUrl:"app/components/map/map.html",controller:"MapController"}).state("pump",{url:"/pump/:id",templateUrl:"app/components/pump/pump.html",controller:"PumpController"})}]),NoahsApp.service("FmiAPIService",["$http",function(e){this.requestTifs=function(t,p){var a={method:"POST",url:"https://noahs-app-backend.herokuapp.com/radar",data:{apikey:t,query:p}};return e(a).then(function(e){return console.log(e),e.data})}}]),NoahsApp.service("PumpService",["$http",function(e){this.pumps=[],this.fakePumps=[{id:1,name:"pumppu lol",latitude:59,longitude:25},{id:2,name:"toka pumppu",latitude:59.5,longitude:25},{id:3,name:"kolmas pumppu",latitude:60,longitude:25}],this.createPumpFromTxt=function(e){for(var t={},p=e.split(","),a=0;a<p.length;a++)p[a]=p[a].trim(),0===a?t.id=p[a].substring(p[a].indexOf("'")+1,p[a].lastIndexOf("'")):1===a?t.name=p[a].substring(p[a].indexOf("'")+1,p[a].lastIndexOf("'")):2===a?t.latitude=parseFloat(p[a]):3===a&&(t.longitude=parseFloat(p[a]));return t},this.generatePumpsFromTxt=function(e){for(var t=[],p=e.split("("),a=0;a<p.length;a++){var o=this.createPumpFromTxt(p[a]);isNaN(o.latitude)||isNaN(o.longitude)||t.push(o)}return t},this.readPumpsFromTxt=function(){this.pumps=this.fakePumps;var e=this,t=new XMLHttpRequest;t.open("GET","/data/pumps.txt",!1),t.onreadystatechange=function(){if(4===t.readyState&&(200===t.status||0==t.status)){var p=t.responseText;e.pumps=e.generatePumpsFromTxt(p)}},t.send(null)},this.fetchPumpData=function(){var t={method:"POST",url:"http://10.144.72.11",data:{apikey:apikey,query:query}};return e(t).then(function(e){return console.log(e),this.pumps=e.data,e.data})["catch"](function(e){return console.log("Calling API produced an error:"),console.log(e.data.message),[]})},this.getPump=function(e){console.log(" id on "+e);for(var t=0;t<this.pumps.length;t++)if(this.pumps[t].id===e||parseInt(this.pumps[t].id)===e)return console.log(this.pumps[t]),this.pumps[t];return console.log("not found"),"no pump found"},this.readPumpsFromTxt()}]),NoahsApp.controller("MainController",["$scope","FmiAPIService",function(e,t){e.apierror={},e.api_field="5c2fc68e-d165-45f5-af8f-ce9fc0b36e68",e.query_field="/wfs?request=GetFeature&storedquery_id=fmi::radar::composite::rr",e.fmilink="",e.tiflinks=[],e.sendRequest=function(){t.requestTifs(e.api_field,e.query_field).then(function(t){console.log("Got result"),console.log(t),e.fmilink=t.fmilink,e.tiflinks=t.tiflinks,e.apierror={}})["catch"](function(t){console.log(t.data.message),e.apierror=t.data,console.log(e.apierror)})},e.generateMap=function(e){},e.checkIfErrorUndefined=function(){return"undefined"==typeof e.apierror.message}}]),NoahsApp.controller("MapController",["$scope","MapService","PumpService",function(e,t,p){t.pumps=p.pumps,t.initMap()}]),NoahsApp.service("MapService",function(){this.mymap="",this.pumps=[{id:1,name:"pumppu lol",latitude:59,longitude:25},{id:2,name:"toka pumppu",latitude:59.5,longitude:25},{id:3,name:"kolmas pumppu",latitude:60,longitude:25}],this.conversion=function(e,t){var p="+proj=utm +zone=35 +ellps=GRS80 +units=m +no_defs +towgs84=0,0,0,-0,-0,-0,0",a="+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs",o=proj4(p,a,[e,t]);return o},this.initMap=function(){var e=new L.Proj.CRS.TMS("EPSG:3067","+proj=utm +zone=35 +ellps=GRS80 +units=m +towgs84=0,0,0,-0,-0,-0,0 +no_defs",[-548576,6291456,1548576,8388608],{resolutions:[8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1,.5,.25]});this.mymap=new L.Map("map",{crs:e,continuousWorld:!0,worldCopyJump:!1,zoomControl:!0,layers:[]});var t="https://{s}.kapsi.fi/mapcache/peruskartta_3067/{z}/{x}/{y}.png",p='&copy; Karttamateriaali <a href="http://www.maanmittauslaitos.fi/avoindata">Maanmittauslaitos</a>',a=new L.Proj.TileLayer.TMS(t,e,{maxZoom:14,minZoom:0,tileSize:256,tms:!1,continuousWorld:!0,attribution:p,subdomains:["tile1","tile2"]}),o="/img/sade-tutka.png",n=[[57.01073316247846,35.67170826858529],[70.49988067141419,8.5139235307523]];L.imageOverlay(o,n).addTo(this.mymap),this.mymap.addLayer(a),this.mymap.setView([65.01275,25.46815],2);var r=L.marker([10.2139235307523,70.49988067141419]).bindPopup("Oikea tuppi").openPopup(),i=L.marker([70.49988067141419,37.37170826858529]).bindPopup("Vasen yl채kulma").openPopup(),u=L.marker([57.01073316247846,10.2139235307523]).bindPopup("Oikea alakulma").openPopup(),s=L.marker([57.01073316247846,37.37170826858529]).bindPopup("Vasen alakulma").openPopup(),m=L.marker([61.7673,23.0764]).bindPopup("Ikaalisen tutka-asema").openPopup(),l=L.marker([63.1048,23.8209]).bindPopup("Vimpelin tutka-asema").openPopup(),d=L.marker([64.7749,26.3189]).bindPopup("Utaj채rven tutka-asema").openPopup(),c=L.marker([62.3045,25.4401]).bindPopup("Pet채j채veden tutka-asema").openPopup(),h=L.marker([62.8626,27.3815]).bindPopup("Kuopion tutka-asema").openPopup(),f=L.marker([61.907,29.7977]).bindPopup("Kiteen tutka-asema").openPopup(),P=L.marker([65.01275,25.56815]).bindPopup("<a target='_blank' href='https://google.com'>I am a popup.</a>").openPopup(),g=L.marker([65.01275,25.46815]).bindPopup("<a target='_blank' href='https://google.com'>I am a popup.</a>").openPopup(),k=L.layerGroup([r,i,u,s,m,l,d,c,h,f,P,g]);L.circle([65.01275,25.46815],500,{color:"red",fillColor:"#f03",fillOpacity:.5}).addTo(this.mymap);k.addTo(this.mymap);for(var v=0;v<this.pumps.length;v++){var y=this.pumps[v],b=L.marker([y.latitude,y.longitude]).bindPopup("<a target='_blank' href='#/pump/"+y.id+"'>Pumppu "+y.id+"</a>").openPopup();b.addTo(this.mymap)}},this.createMarker=function(){var e=L.marker([64.01275,25.46815]).bindPopup("<a href=''>JOKU UUS<").openPopup();L.layerGroup([e]);e.addTo(this.mymap)},this.createPumpMarkers=function(e){for(var t=[],p=0;p<e.length;p++){var a=e[p],o=L.marker([a.latitude,a.longitude]).bindPopup("Pumppu "+a.id).openPopup();t.push(o),o.addTo(this.mymap)}console.log(t)}}),NoahsApp.controller("PumpController",["$scope","$stateParams","MapService","PumpService",function(e,t,p,a){e.id=t.id,e.pump=a.getPump(parseInt(e.id)),e.generatePumps=function(){}}]),NoahsApp.directive("navDirective",function(){return{templateUrl:"app/components/nav/nav.html"}});
//# sourceMappingURL=app.min.js.map
